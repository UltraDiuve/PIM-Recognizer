    \chapter{Le périmètre produit}
    \label{perimetre_produit}

    \section{Les produits non-alimentaires}
    \label{produits_nonal}
    Un petit apparté est nécessaire concernant les produits non-alimentaires.
    Si l'essentiel des produits commercialisés par les branches du groupe sont des produits alimentaires, comme évoqué précédemment une partie de l'activité commerciale se fait tout de même autour de produits non-alimentaires.
    Ces produits restent malgré tout destinés exclusivement aux professionnels des métiers de bouche, et il s'agit de consommables (par opposition à des articles d'électroménager, de la vaisselle non-jetable, \dots).

    On distingue en général deux catégories de produits non-alimentaires : 
    \begin{itemize}
        \item les produits dits \og d'hygiène \fg
        \item les produits dits \og de chimie \fg
    \end{itemize}

    Les produits de chimie regroupent les produits qui doivent faire l'objet d'une fiche de données de sécurté au sens du réglement Européen No 1907/2006 dit \og REACH \fg (Registration, Evaluation, Authorisation and Restriction of Chemicals) \cite{reach_text}.

    On appelle produits d'hygiène tous les autres produits non-alimentaires.
    L'appelation \og d'hygiène \fg est donc réductricte, dans la mesure où cette large famille regroupe les consommables de nettoyage (éponges, papiers absorbants, \dots) mais également tout type d'autres consommables (serviettes de tables, gobelets en plastiques, pics à brochettes, boîtes de produits à emporter, \dots).

    \emphbox{La commercialisation de produits non-alimentaires existe au sein du groupe, mais on se focalisera pour la suite sur les produits alimentaires qui reste le coeur de métier.}

        \section{Accessibilité de la donnée en fonction des branches}

        Comme vu à la section \mref{outils_infos}, les systèmes d'information associés à la gestion de l'information produit offrent des niveaux d'accès hétérogènes à la donnée produit.
        Le récapitulatif par branche est le suivant : 
        \begin{description}
            \item[\'{E}piSaveurs :] on peut simplement accéder à l'ensemble des données produit, structurées, non structurées (i.e. textes longs) et pièces jointes
            \item[PassionFroid :] on a uniquement la possibilité d'exporter manuellement les données structurées articles depuis le système de gestion SAP.
            Elles permettent de produire quelques analyses quantitatives.
            Il est difficile de faire des exports en masse de l'outil de gestion de l'information produit GIP (cf. section \mref{GIP}).
            \item[TerreAzur :] idem PassionFroid, si ce n'est qu'en plus le système GIP n'est pas utilisé au sein de cette branche.
            \item[Délice et Création :] le système d'information ne permet pas d'exporter les données et donc de produire des indicateurs détaillés. On peut toutefois avoir des informations quantitatives de la part des opérationnels.
            \item[Saveurs d'Antoine :] idem Délice et Création
            \item[Pomona Suisse :] la branche est en cours de structuration, et les référentiels articles ne sont pas partagés entre les succursales. Il n'est pas possible d'obtenir d'information quantitative sur ces données.
            \item[Pomona Iberia :] idem Pomona Suisse
        \end{description}

        Pour les analyses quantitatives, on pourra se baser sur des extractions uniquement pour les branches RHD (\'{E}piSaveurs, PassionFroid, TerreAzur).
        L'ensemble des analyses portant sur les branches RHD sont produites sur la base d'extractions de leur système de gestion SAP.

        \section{Analyses quantitatives}

        Les graphes de cette section ont été produits via le code présenté en annexe, au chapitre \mref{code:analyse_quantitative}.
        Les données pour les branches spécialistes (Délice et Création et Saveurs d'Antoine) sont issues d'informations fournies par le métier, hors système.
        Dans l'ensemble de cette section, on raisonnera à la maille \emph{article} (cf. la définition article vs. produits, présentée à la section \mref{produit_article}).

            \subsection{Comparatifs entre les branches}

                En termes de volumétrie article (cf. \reffig{fig:volumetrie_article}, c'est TerreAzur qui possède le référentiel le plus étendu (environ 62 000 articles de marchandises actifs).
                Cela s'explique par le fait que cette branche commercialise essentiellement des produits bruts, non-préemballés (ex : des cagettes de fruits ou de légumes).
                Or, ces produits ne sont pas clairement identifiés, par exemple par un GTIN.
                Au démarrage de SAP pour cette branche, afin de limiter la charge sur les gestionnaires de référentiels, le parti a été pris de créer en avance de phase l'ensemble des articles susceptibles d'être commercialisés.
                Cela s'est traduit par la création d'un grand nombre d'articles, du fait de l'application \og brutale \fg de la combinatoire des différents critères pouvant définir un produit.
                Un exemple (fictif) serait, sur les pommes : 
                \begin{itemize}
                    \item 8 variétés possibles (Gala, Golden, \dots)
                    \item 4 calibres possibles
                    \item 6 conditionnements possibles (plateau 6kg, plateau 4,5kg, \dots)
                    \item 2 catégories (I, II)
                    \item 8 origines (France, Espagne, \dots)
                \end{itemize}
                ce qui donne un total de 3072 articles uniquement sur cette gamme de produits.

                Viennent ensuite PassionFroid, et \'{E}piSaveurs, qui sont les autres \og grosses \fg branches historiques du Groupe.

                \begin{figure}[htbp]\CenterFloatBoxes
                    \begin{floatrow}
                    \ffigbox{%
                        \includegraphics[width=200pt]{img/Articles par branche.png}%
                    }{%
                      \caption{Volumétrie article par branche}%
                      \label{fig:volumetrie_article}%
                    }
                    \capbtabbox[][][c]{%
                        \input{tbls/Articles par branche.tex}%
                    }{%
                      \caption{Volumétrie article par branche}%
                    }
                    \end{floatrow}
                \end{figure}
                    
                Une analyse du recouvrement des référentiels montre que dans l'ensemble, les branches ne travaillent pas les mêmes articles (cf. \reffig{fig:venn_article}).
                PassionFroid commercialise certains produits des branches \'{E}piSaveurs et TerreAzur, mais cela s'explique par une petite entité luxembourgeoise qui travaille des produits de tout type de stockage.
                Une réserve toutefois par rapport à cette analyse de recouvrement produit : elle sous-estime vraisemblablement lesdits recouvrements, dans la mesure où la présence de doublons n'est pas prise en compte.

                \begin{figure}[htbp]
                    \begin{center}
                    \includegraphics[width=\linewidth]{img/Diagrammes de Venn articles.png}
                    \end{center}
                    \caption{Recouvrements entre branches RHD}
                    \label{fig:venn_article}
                \end{figure}       

            \subsection{Les grands types de produits}

            Comme montré à la \reffig{fig:repart_art_categ}, on voit bien (en plus du fait que les articles étaient peu partagés entre les branches) que : 
            \begin{itemize}
                \item les deux types d'articles (négoce et presté) sont utilisés par les 3 branches
                \item c'est tout de même PassionFroid qui fait l'utilisation majoritaire d'articles prestés
                \item les branches \emph{ne} partagent \emph{pas} l'utilisation des autres \og catégories \fg\ (groupe de marchandises, conditions de stockage, hiérarchie produit, \dots)
            \end{itemize}
            Les indicateurs sont également récapitulés dans la \reftable{tab:repart_art_categ}.

            \begin{figure}[htbp]
                \begin{center}
                \includegraphics[width=\linewidth]{img/Repartition articles categories.png}
                \end{center}
                \caption{Répartition des articles en fonction des variable catégorielles}
                \label{fig:repart_art_categ}
            \end{figure}

            \begin{table}[htbp]
                \footnotesize
                \begin{center}
                \input{tbls/Repartition par type.tex}
                \vspace{5pt}
                \input{tbls/Repartition par march_group.tex}
                \vspace{5pt}
                \input{tbls/Repartition par storage_cond.tex}
                \vspace{5pt}
                \input{tbls/Repartition par hier1.tex}
                \end{center}
                \caption{Utilisation des variables catégorielles article au sein des branches RHD}
                \label{tab:repart_art_categ}
                \normalsize
            \end{table}

            Possibilité d'extension: 
            - ajouter la vision produit (via les FIA)
            - faire une sorte d'heatmap qui montre la forte correlation entre les différentes variables catégorielles (et les définitions associées. Ex: ZELAB + SA = Saurisserie, etc...)

    \chapter{Les données utilisables, issues du PIM}
        \large
        Comme vu au chapitre \mref{perimetre_produit}, les données produit ne sont simplement accessibles que pour la branche \'{E}piSaveurs.
        On se focalisera donc sur cette branche pour la suite de cette étude, ainsi que sur les produits alimentaires (en excluant donc les produits d'hygiène et de chimie, cf. section \mref{produits_nonal}).
        Contrairement au chapitre précédent, ici on travaillera à la maille \emph{produit} (cf. la distinction produit vs. article section \mref{produit_article}).
        L'ensemble des tableaux et graphes de ce chapitre ont été produit via le notebook "Analyse des données du PIM", présenté en annexe \mref{code:analyse_donnees_PIM}.
        \normalsize

        \section{Données structurées}

            \subsection{Description des données structurées}

        Les données dites structurées sont l'ensemble des données qui peuvent prendre leurs valeurs dans un domaine restreint.
        Par exemple, ce sont les données booléennes, les choix issus de listes déroulantes, les valeurs numériques\dots
        Les principales données structurées pour les produits alimentaires dans le PIM sont : 
        \begin{description}
            \item[le code du produit :] calculé par le système
            \item[le fournisseur :] référence croisée vers le code du fournisseur
            \item[le type de produit :] épicerie, boisson alcoolisée, hygiène, chimie, boisson non-alcoolisée
            \item[le GTIN du produit :] identifiant numérique unique, utilisé entre autres pour l'étiquetage sous forme de code à barres~\cite{GS1_GTIN}
            \item[le type d'unité de base :] paquet, boîte, sachet, rouleau, bouteille, pot, \dots
            \item[les poids :] brut, net, net égoutté (pour les conserves)
            \item[le volume :] pour les produits liquides
            \item[les durées de vie :] le type (Date Limite de Consommation ou Date de Durabilité Minimale) et la durée (totale à fin de production, garantie à livraison)
            \item[les modes de conservation avant/après ouverture :] à température ambiante, au réfrigérateur puis à consommer sous 2 jours, \dots
            \item[les labels :] le(s) label(s) s'appliquant au produit (cf. section \ref{labels} page \pageref{labels})
            \item[les régimes particuliers :] Halal, Casher, Sans porc, Végétarien, Végétalien, \dots
            \item[les caractéristiques spéciales :] sans OGM, non traité par ionisation
            \item[la présence d'allergènes :] le niveau de présence de chacun des 14 allergènes réglementés (cf. section \mref{composition}) : absence, présence ou traces
            \item[les matières grasses utilisées :] palme, beurre, coco, tournesol, palmiste, \dots
            \item[les additifs présents :] les codes Exxx et les fonctions des additifs mis en oeuvre~\cite{additifs_regl_eu}\cite{additifs_wiki}
            \item[les données nutritionnelles obligatoires :] pour 100g ou 100mL, valeur énergétique (en kJ et kcal), matières grasses, dont acides gras saturés, Glucides, dont sucres simples, Fibres, Protéines, simplement
            \item[les données nutritionnelles facultatives :] vitamines, minéraux, omégas, \dots
            \item[les allégations nutritionnelles :] riche en, faible en, sans,\dots associé à un nutriment défini dans les 2 points précédents
            \item[le nutriscore :] note allant de A à E, définie dans la loi Santé de janvier 2016
            \item[le taux de TVA :] un des quatre taux définis dans la réglementation française
            \item[le code nomenclature douanière :] code identifiant les marchandises défini par les douanes pour la Déclaration d'\'{E}change de Biens~\cite{notions_DEB}
            \item[le pays d'origine pour la DEB :] le pays d'origine à déclarer dans la Déclaration d'\'{E}change de Biens~\cite{notions_DEB}
            \item[les informations logistiques :] il s'agit du plan de conditionnement et de palettisation du produit. Elles regroupent les différents niveaux et les quantités pour passer de l'un à l'autre (ex : 3 boites dans un cartons, 64 cartons dans une palette), les poids et dimensions de ces niveaux logistiques, leurs GTIN, \dots
        \end{description}
        
            \subsection{Analyse de ces données structurées}

                \subsubsection{Le statut des produits}\label{statuts}
                Comme cela a été présenté à la \reffig{fig:processus_article}, le processus de gestion de l'information produit fait intervenir de multiples acteurs et peut donc être assez long.
                Un produit qui n'est pas arrivé au bout du processus et fait l'objet de contrôles et validations successives n'est pas réputé comme portant des informations correctes.
                Dans le PIM, la \og localisation \fg~du produit dans le processus est portée par son statut (c'est une simple donnée catégorielle).
                Seuls les produits au statut \og Validé \fg~sont considérés comme portant des données valides.
                La répartition des produits pour chacun des statuts est présenté à la \reffig{fig:products_status}.

                \begin{figure}[htbp]\CenterFloatBoxes
                    \begin{floatrow}
                    \ffigbox{%
                        \includegraphics[width=200pt]{img/products_status.png}%
                    }{%
                      \caption{Répartition des produits par statut}%
                      \label{fig:products_status}%
                    }
                    
                    \capbtabbox[][][c]{%
                        \tiny%
                        \input{tbls/products_status.tex}%
                        \normalsize%
                    }{%
                      \caption{Répartition des produits par statut}%
                    }
                    \end{floatrow}
                \end{figure}        

                De plus, comme cela a été présenté dans la section migration \mref{migration}, certains produits ont fait l'objet d'un contrôle et d'une correction après le démarrage, mais d'autres non.
                Il est nécessaire de prendre également cet aspect en compte si l'on souhaite avoir la vision des produits qui sont censés avoir des données correctes.
                La détermination du statut des produits vis-à-vis du processus de migration se fait au travers de facettes :
                \begin{itemize}
                    \item les produits qui ont été créés lors de la reprise de données initiale portent une facette "beginningMigration"
                    \item les produits créés dans le PIM après le démarrage (cas des nouveaux référencements) ne portent pas cette facette
                    \item les produits issus de la migration (portant la facette "beginningMigration") sont envoyés aux fournisseurs pour qu'ils complètent les données 
                    \item une fois que le processus de validation de l'information produit est terminé (validation des gestionnaires de référentiels), une facette "endMigration" est apposée sur le produit
                \end{itemize}
                La répartition des produits fonction de leurs statuts de migration est présenté à la \reftable{tbl:migration_status}.
                Les produits portant des données correctes, du point de vue de la migration, sont : 
                \begin{itemize}
                    \item ceux qui ont été créés après le démarrage (donc qui ont été créés avec le processus et les règles de gestion cible)
                    \item ceux qui ont été créés à la reprise, mais qui sont identifiés comme ayant terminé le processus de migration (portant la facette de fin)
                \end{itemize}

                \begin{table}[htbp]
                    \begin{center}
                    \input{tbls/migration_status.tex}
                    \caption{Répartition des produits par statut de migration}
                    \label{tbl:migration_status}
                    \end{center}
                \end{table}

                Si on combine le statut des produits avec leurs statut de migration, on peut calculer un statut \og Données valides \fg qui doit permettre d'identifier des produits avec des données de qualité.
                C'est ce statut qui sera utilisé dans les paragraphes suivants, lorsqu'on fera des anlyses relatives à la qualité des données.
                \label{def:en_qualite}
                On nommera ces statuts \og En qualité \fg et \og Hors qualité \fg pour la suite de ce document.
                La définition du statut \og En qualité \fg est la suivante : 
                \begin{itemize}
                    \item le produit est au statut \og Validé \fg, c'est-à-dire qu'il est dans un statut terminal sans erreur
                    \item ET
                    \begin{itemize}
                        \item le produit a été créé depuis le démarrage du PIM, en respectant les règles de gestion de ce nouveau système
                        \item OU BIEN
                        \item le produit a été repris depuis le système de gestion historique (le GIP), et il a fait l'objet d'un processus de remise à niveau complet. Il est donc conforme aux règles de gestion de ce nouveau système
                    \end{itemize}
                \end{itemize}
                Les autres produits sont considérés \og Hors qualité \fg.
                La volumétrie des produits en fonction de chacun de ces statuts est présentée à la \reftable{tbl:products_quality}.

                \begin{table}[htbp]
                    \begin{center}
                    \input{tbls/products_quality.tex}
                    \caption{Répartition des produits par \og qualité des données \fg}
                    \label{tbl:products_quality}
                    \end{center}
                \end{table}

                \subsubsection{Données d'identification}
                Un exemple et une description statistique de ces données est présentées aux \reftable{tbl:exemple_idt} et \reftable{tbl:desc_idt}.
                On peut en tirer les conclusions suivantes : 
                \begin{itemize}
                    \item Les codes produits sont bien des identifiants uniques des produits : on a autant de valeurs uniques que de valeurs renseignées
                    \item Une proportion importante de produits (91\%) porte un GTIN (cf. \cite{GS1_GTIN}), ce qui reflète une \og maturité \fg des filières produits avec lesquelles travaille \'{E}piSaveurs.
                    \item Ces GTIN sont également censés être des identifiants uniques des produits. Néanmoins, comme présenté à la \reffig{fig:produit_par_GTIN}, il peut arriver que le même GTIN soit présent sur plusieurs produits. Quelques illustrations et explications sont présentées en annexe, dans le notebook d'analyse des données.
                    \item La distribution numérique des produits par fournisseur est importante. Il existe plus de 600 fournisseurs pour les 13000 produits, et l'essentiel des fournisseur n'ont qu'un nombre très limité de produits. On peut avoir une vision à la \reffig{fig:distrib_fourn_pdts} ou à la \reffig{fig:rappel_pdt_par_frn}.
                \end{itemize}

                \begin{figure}[htbp]\CenterFloatBoxes
                    \begin{floatrow}
                    \ffigbox{%
                        \includegraphics[width=200pt]{img/repartition_gtin.png}%
                    }{%
                      \caption{Nombre de produits par GTIN}%
                      \label{fig:produit_par_GTIN}%
                    }
                    \capbtabbox[][][c]{%
                        \input{tbls/gtin_counts.tex}%
                    }{%
                      \caption{Nombre de produits par GTIN}%
                    }
                    \end{floatrow}
                \end{figure}        

                \begin{figure}[htbp]
                    \begin{center}
                    \includegraphics[width=\linewidth]{img/distribution_fournisseurs_par_prd_count.png}
                    \end{center}
                    \caption{Distribution des fournisseurs par nombre de produits}
                    \label{fig:distrib_fourn_pdts}
                \end{figure}
        
        \begin{landscape}   
            \begin{table}
                \RawFloats
                {\scriptsize
                \begin{center}
                \input{tbls/Exemple identification.tex}%
                \caption{Exemples de codes d'identification}%
                \label{tbl:exemple_idt}%
                \bigskip\bigskip
                \input{tbls/Desc identification.tex}%
                \caption{Description des codes d'identification sur le dataframe}%
                \label{tbl:desc_idt}%   
                \end{center}
                }
            \end{table}

            \begin{table}
                \RawFloats
                {\scriptsize
                \begin{center}
                \input{tbls/Exemple dimensions.tex}%
                \caption{Exemples de dimensions}%
                \label{tbl:exemple_dim}%
                \bigskip\bigskip
                \input{tbls/Desc dimensions.tex}%
                \caption{Description des dimensions sur le dataframe}%
                \label{tbl:desc_dim}%  
                \end{center}
                }
            \end{table}

            \begin{table}
                \RawFloats
                {\scriptsize
                \begin{center}
                \input{tbls/Exemple conservation.tex}%
                \caption{Exemples de conservation}%
                \label{tbl:exemple_cons}%
                \bigskip\bigskip
                \input{tbls/Desc conservation.tex}%
                \caption{Description des conservations sur le dataframe}%
                \label{tbl:desc_cons}%  
                \end{center}
                }
            \end{table}

        \normalsize
        \end{landscape}

        \section{Données non structurées}
        
            \subsection{Les libellés}
            \label{libelles}

            Plusieurs libellés permettent de faire référence à chaque produit, avec des usages distincts:
            \begin{description}
                \item[Libellé temporaire unité de besoin :] il s'agit simplement d'un libellé qui est choisi par la personne à l'origine de la demande de référencement produit (souvent l'acheteur, cf. \reffig{fig:processus_article}), afin que le fournisseur comprenne sur quel produit porte le référencement.
                \item[Désignation du produit fournisseur :] c'est le libellé qui est donné par le fournisseur afin d'identifier simplement son produit.
                \item[Code article interne fournisseur :] c'est l'identifiant du produit, dans le système de gestion du fournisseur. Il s'agit généralement de codes, avec autant de formats distincts que de fournisseur venant contribuer.
                \item[Marque commerciale du produit :] il s'agit du nom de la marque commerciale du produit. 
                \item[Dénomination réglementaire :] c'est le libellé qui doit décrire de manière neutre le produit, sans notion liée au marketing (telle que la marque, entre autres), et qui doit obligatoirement figurer sur l'emballage du produit.
                \end{description}

            Des exemples de libellés sont présentés à la \reftable{tbl:exemple_lib}.

            {\renewcommand{\arraystretch}{2}%
            \begin{table}[htbp]
                {\scriptsize
                \begin{center}%
                \input{tbls/designation_example.tex}%
                \caption{Exemples de libellés produit}%
                \label{tbl:exemple_lib}%
                \end{center}%
                }
            \end{table}
            }

            \subsection{Types de pdf possédés}

            Une information intéressante est de faire le point sur la possibilité ou non d'extraire les textes des pdf possédés.
            En effet, cela permet d'en exporter le contenu avec plus de simplicité et de fiabilité qu'en ayant recours à des fonctionnalités d'OCR (Optical Caracter Recognition~\cite{OCR_wiki}).
            Pour obtenir cet indicateur, on a procédé de la manière suivante : 
            \begin{itemize}
                \item extraction des fichiers pdf correspondant aux étiquettes et aux fiches techniques des produits appartenant à l'échantillon de données manuellement étiquetées (la ground truth, cf. la section à venir \mref{manually_labelled_data})
                \item application des traitements d'extractions de textes depuis les pdf sur l'ensemble de ces fichiers
                \item comptage de ceux parmi eux qui apparaissent \og vides \fg, c'est à dire dont le retour de ces fonctionnalités les affiche comme contenant uniquement des whitespaces (espaces, tabulation, retours à la ligne, \og form feed caracters \fg, \dots)
            \end{itemize}
            L'application de cette méthode est présentée à la fin du notebook \og Génération de l'échantillon de données manuellement étiquetées \fg présenté en annexe \mref{code:ground_truth}.
            Les résultats de cette analyse sont présentés à la \reftable{tbl:empty_attached_files}.
            
            On en déduit :
            ~\begin{itemize}
                \item que la très grande majorité des fiches techniques on un contenu textuel extractible (96\%)
                \item que les étiquettes, en plus d'être moins représentées que les fiches techniques, ont pour les deux tiers d'entre elles un contenu qui n'est pas exploitables par les outils de pdfmining
            \end{itemize}
