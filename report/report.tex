\documentclass{report}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[french]{babel}

\usepackage{lmodern}

\usepackage{setspace}
\spacing{1.5}

\usepackage[top=2.5cm, bottom=2.5cm, left=2.5cm, right=2.5cm]{geometry}

\usepackage{url}

\usepackage{graphicx}

\usepackage{array,multirow,makecell,tabularx}
\renewcommand\tabularxcolumn[1]{>{\centering\arraybackslash}m{#1}}
\newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}}
\usepackage{booktabs}
\usepackage{floatrow}
% Table float box with bottom caption, box width adjusted to content
\newfloatcommand{capbtabbox}{table}[][\FBwidth]
\usepackage{rotating}
\usepackage{lscape}

\usepackage{pdfpages}

\usepackage{listings}
\usepackage{minted}

\usepackage{hyperref}

\usepackage{titlesec} 
\titleclass{\part}{top} % changing part so that it does not take a full page.
\titleformat{\part}
    [display] % shape
    {\centering\normalfont\Huge\bfseries} % format
    {\MakeUppercase{\partname}\vspace{1pc}} % label
    {0pt} % set between label and title body
    {\titlerule[2pt]\vspace{1pc}\Huge\MakeUppercase} % before body
\titlespacing*{\part}
    {0pt} % left 
    {0pt} % before sep
    {10pt} % after sep

\titleclass{\chapter}{straight} % make chapter like a section (no newpage)
\titleformat{\chapter}
    [display] % shape
    {\centering\normalfont\huge\bfseries} % format
    {\chaptertitlename ~\thechapter} % label 
    {0pt} % sep between label and title body
    {\huge\MakeUppercase} % before body
\titlespacing*{\chapter}
    {0pt} % left
    {20pt} % before sep
    {20pt} % after sep

\usepackage{chngcntr}
\counterwithout{figure}{chapter}
\counterwithout{table}{chapter}
    

\newcommand{\emphbox}[1]{
    \vspace{5mm}
    \noindent\fbox{ 
        \begin{minipage}[c]{\linewidth}
            {\em #1}
        \end{minipage}
    }
}

\newcommand{\reffig}[1]{F\textsc{igure}~\ref{#1} page~\pageref{#1}}

\newcommand{\reftable}[1]{T\textsc{able}~\ref{#1} page~\pageref{#1}}

\newcommand{\mref}[1]{\ref{#1} page~\pageref{#1}}

\title{Extraction de données relatives aux produits alimentaires à partir de documents non structurés}
\author{Pierre \textsc{massé}}
\date{Juin 2020}

\begin{document}

\maketitle

\large
\begin{abstract}   
    
    La gestion de l'information produit est devenu un enjeu de société majeur ces dernières années.
    Les scandales sanitaires récents ont déclenché une prise de conscience collective des consommateurs, en parallèle de la mise en place de réglementations de plus en plus contraignantes pour l'ensemble des acteurs de la filière~\cite{incotext}\cite{incoexpl}.
    \`{A} ce titre, le Groupe Pomona a lancé ces dernières années un projet majeur de refonte des processus et des outils de gestion de l'information produit.

    La première filiale du Groupe a fait l'objet d'un déploiement réussi, mais cela a toutefois mis en évidence le fait que des gains à la fois en qualité et en productivité restent accessibles.

    La mise en place d'outils mettant en oeuvre les principes du Machine Learning appliqués au traitement du langage permettrait d'aider les opérationnels de la gestion de l'information à interpréter plus vite et mieux les documents mis à disposition par les fournisseurs du Groupe.

    Le présent rapport détaille la mise en place d'un outil permettant d'extraire les listes d'ingrédients des fiches techniques transmises par les fabricants des produits.
\end{abstract}
\normalsize

\tableofcontents

\input{business}

\input{data}

\input{objectifs}

\part{Construction du modèle}
    \chapter{Les principes généraux}
        \section{Contenu du texte d'une liste d'ingrédients}

        En général, chaque ingrédient sera présent une seule fois dans la liste.

        Le calcul d'embeddings via des modèles tels que SVD ou Word2Vec fait peu de sens.
        \newline
        \newline
        \emphbox{l'extraction des textes se fait au format \emph{Bag Of Words}, sans utiliser de notion d'IDF. L'utilsation de TF semble églament sujette à caution.}

        \section{Limitation à l'identification des listes d'ingrédients}

        On est sur une taxonomie d'informations limitée dans les fiches techniques.

        On pourrait envisager de classifier l'ensemble des textes présents dans les fiches techniques.

        Mais l'absence de données étiquetées rend cette tâche impossible. La charge d'étiquetage d'un nombre représentatif de blocs de texte de fiches techniques est trop importante pour être mise en oeuvre dans le cadre de ce projet.

        \section{Conversion de documents en texte}
        
        dire ici qu'on utilise principalement pdfminer vs. d'autres outils d'OCR.

        De plus, on partira dans un premier temps sur une transformation basique d'un document en texte, sans passer par une analyse de la localisation des textes sur le document.
            
    \chapter{Construction d'un modèle simple \og ouvert \fg}
        
    Expliciter le principe de ce modèle avec un schéma simple.

    Pas de mesure possible de la performance

        \section{Extraction des données}

        Ne garder que produits d'épicerie et boissons non alcoolisées

        \section{Conversion en blocs de texte}
        \section{Train/Test split}
        \section{Entrainement du modèle}
        \section{Calcul de la similarité}
        \section{Illustration des résultats obtenus}
    
    \chapter{Utilisation des données manuellement étiquetées}

    Expliciter pourquoi on ne peut pas faire tourner (référence parties précédentes) sur l'ensemble des données
        
        \section{Chargement des données manuellement étiquetées}

        \section{Train/Test split}

        \section{Entraînement du modèle}

        \section{Illustration des prédictions obtenues}


    \chapter{Mesure de la performance}
    
        \section{Précision}
            \subsection{Approche naïve}

            \subsection{Avec du \og text-postprocessing \fg}
        
        \section{Similarité cosinus}

        \section{Fonction de \emph{loss} spécifique}

        Expliciter les diverses distances, et pourquoi certaines sont plus pertinentes que d'autres.

        Ex : on ne garde pas la distance de Hamming
            \subsection{Distance de Levenshtein}

            \subsection{Distance de Dameray-Levenshtein}

            \subsection{Distance de Jaro}

            \subsection{Distance de Jaro-Wrinkler}
    
        \section{Cross-validation des modèles précédents}
            
            \subsection{Modèle \og ouvert \fg}

            \subsection{Modèle entraîné sur les données étiquetées manuellement}

    \chapter{Transfer learning}
        
        \section{Principe du pré-entraînement}
        
        Expliquer qu'il s'agit d'une approche hybride des 2 modèles précédents

        \section{Illustration de l'impact sur la performance}


    \chapter{Hyperparameter tuning}
            
        \section{Les paramètres ajustables}

        \section{Application d'une grid search}

\part{Travaux subséquents}
    \chapter{Opérationnalisation de cette maquette}    
        \section{Client et sponsor métier}
        \section{Définition des règles de gestion}
        \section{Mise en place d'une organisation projet}
        \section{Industrialisation du code}
        Prochaines étapes : opérationnalisation via API \\
        Documentation
        \section{Monitoring de la performance du modèle}
    \chapter{Extension des fonctionnalités offertes}
        \section{Prise en compte de nouveaux types de pièces jointes}
        \section{Utilisation d'outil d'OCR pour les pdf non structurés}
        \section{Mise en place d'outil de spatialisation des textes}
        \section{Construction d'outils d'extraction de données connexes à la composition}
        \section{\'{E}largissement aux données nutritionnelles}
        \section{Extraction d'informations complémentaires}
        \section{\'{E}valuation de la performances sur d'autres familles de produits}


\appendix
\part{Annexes}
    \chapter{Figures, tableaux et bibliographie}
        \listoftables
        \listoffigures
        \bibliographystyle{plain}
        \bibliography{./biblio} 
    \chapter{Exemple de documents fournisseur}
        \section{Fiches techniques}
        \section{\'{E}tiquettes produit}
        \section{Fiches logistiques}
    \chapter{Le code utilisé}
        \includepdf[pages=-,
                    pagecommand={},
                    addtotoc={1,
                              section,
                              3,
                              Analyse quantitative,
                              code:analyse_quantitative}]
                    {notebooks/Analyse quantitative.pdf}

        \section{Gestion du fichier de configuration}
        Ce petit module a pour but de permettre de gérer les paramètres du progamme dans un fichier de configuration (afin de simplifier la maintenance).
        Il est utilisé dans l'ensemble des autres modules de ce projet.
        \inputminted[fontsize=\scriptsize]{python}{../src/conf.py}
        Un exemple de fichier de configuration (dont certains champs ont été anonymisés pour des raisons de confidentialité) est présenté ci-dessous.
        TODO !! Mettre le fichier ici.

        \section{Extraction des données du PIM}
            \inputminted[fontsize=\scriptsize]{python}{../src/pimapi.py}
        
        \section{Analyse des données du PIM}
        \includepdf[pages=-,
                    pagecommand={},
                    addtotoc={1,
                              section,
                              3,
                              Analyse des données du PIM,
                              code:analyse_donnees_PIM}]
                    {notebooks/Analyse donnees du PIM.pdf}

        \section{Conversion des pièces jointes en textes}
            \inputminted[fontsize=\scriptsize]{python}{../src/pimpdf.py}
        
        \section{Identification des listes d'ingrédients}
            \inputminted[fontsize=\scriptsize]{python}{../src/pimest.py} 
 
\end{document}